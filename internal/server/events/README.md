<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# events

```go
import "github.com/agentstation/starmap/internal/server/events"
```

Package events provides a unified event system for real\-time catalog updates.

This package implements a broker pattern that connects Starmap's hooks system to multiple transport mechanisms \(WebSocket, SSE, etc.\) through a common event pipeline. This eliminates code duplication and provides a single point for event distribution.

## Index

- [type Broker](<#Broker>)
  - [func NewBroker\(logger \*zerolog.Logger\) \*Broker](<#NewBroker>)
  - [func \(b \*Broker\) Publish\(eventType EventType, data any\)](<#Broker.Publish>)
  - [func \(b \*Broker\) Run\(ctx context.Context\)](<#Broker.Run>)
  - [func \(b \*Broker\) Subscribe\(sub Subscriber\)](<#Broker.Subscribe>)
  - [func \(b \*Broker\) SubscriberCount\(\) int](<#Broker.SubscriberCount>)
  - [func \(b \*Broker\) Unsubscribe\(sub Subscriber\)](<#Broker.Unsubscribe>)
- [type Event](<#Event>)
- [type EventType](<#EventType>)
- [type Subscriber](<#Subscriber>)


<a name="Broker"></a>
## type [Broker](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L14-L21>)

Broker manages event distribution to multiple subscribers. It provides a central hub for catalog events, fanning them out to all registered subscribers \(WebSocket, SSE, etc.\) concurrently.

```go
type Broker struct {
    // contains filtered or unexported fields
}
```

<a name="NewBroker"></a>
### func [NewBroker](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L24>)

```go
func NewBroker(logger *zerolog.Logger) *Broker
```

NewBroker creates a new event broker.

<a name="Broker.Publish"></a>
### func \(\*Broker\) [Publish](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L99>)

```go
func (b *Broker) Publish(eventType EventType, data any)
```

Publish sends an event to all subscribers.

<a name="Broker.Run"></a>
### func \(\*Broker\) [Run](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L36>)

```go
func (b *Broker) Run(ctx context.Context)
```

Run starts the broker's event loop. Should be called in a goroutine. The broker will run until the context is cancelled.

<a name="Broker.Subscribe"></a>
### func \(\*Broker\) [Subscribe](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L116>)

```go
func (b *Broker) Subscribe(sub Subscriber)
```

Subscribe registers a new subscriber to receive events.

<a name="Broker.SubscriberCount"></a>
### func \(\*Broker\) [SubscriberCount](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L126>)

```go
func (b *Broker) SubscriberCount() int
```

SubscriberCount returns the current number of subscribers.

<a name="Broker.Unsubscribe"></a>
### func \(\*Broker\) [Unsubscribe](<https://github.com/agentstation/starmap/blob/master/internal/server/events/broker.go#L121>)

```go
func (b *Broker) Unsubscribe(sub Subscriber)
```

Unsubscribe removes a subscriber from receiving events.

<a name="Event"></a>
## type [Event](<https://github.com/agentstation/starmap/blob/master/internal/server/events/types.go#L30-L34>)

Event represents a catalog event with type, timestamp, and data.

```go
type Event struct {
    Type      EventType `json:"type"`
    Timestamp time.Time `json:"timestamp"`
    Data      any       `json:"data"`
}
```

<a name="EventType"></a>
## type [EventType](<https://github.com/agentstation/starmap/blob/master/internal/server/events/types.go#L12>)

EventType represents the type of catalog event.

```go
type EventType string
```

<a name="ModelAdded"></a>Event types for catalog changes.

```go
const (
    // Model events (from Starmap hooks)
    ModelAdded   EventType = "model.added"
    ModelUpdated EventType = "model.updated"
    ModelDeleted EventType = "model.deleted"

    // Sync events (from sync operations)
    SyncStarted   EventType = "sync.started"
    SyncCompleted EventType = "sync.completed"

    // Client events (from transport layers)
    ClientConnected EventType = "client.connected"
)
```

<a name="Subscriber"></a>
## type [Subscriber](<https://github.com/agentstation/starmap/blob/master/internal/server/events/subscriber.go#L6-L13>)

Subscriber is an interface for event consumers. Implementations adapt the unified event stream to specific transport mechanisms \(WebSocket, SSE, MQTT, webhooks, etc.\).

```go
type Subscriber interface {
    // Send delivers an event to the subscriber.
    // Implementations should be non-blocking and handle errors gracefully.
    Send(Event) error

    // Close cleanly shuts down the subscriber.
    Close() error
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
