# sources

Package sources provides abstractions for fetching AI model catalog data from various external sources including provider APIs and community repositories.

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# sources

```go
import "github.com/agentstation/starmap/pkg/sources"
```

Package sources provides public APIs for working with AI model data sources.

Package sources defines interfaces and types for catalog data sources. Sources are responsible for fetching and synchronizing model data from various providers including local files, provider APIs, and external repositories.

The package provides a unified interface for different data sources while supporting merge strategies, authorities for data precedence, and flexible configuration options.

Example usage:

```
// Create a provider fetcher
fetcher := NewProviderFetcher(providers)

// Fetch models from a provider
models, err := fetcher.FetchModels(ctx, provider)
if err != nil {
    log.Fatal(err)
}

// Check if a provider is supported
if fetcher.HasClient(providerID) {
    // Provider has a client implementation
}
```

## Index

- [type Dependency](<#Dependency>)
- [type DependencyStatus](<#DependencyStatus>)
- [type FetchStats](<#FetchStats>)
  - [func \(s \*FetchStats\) HumanSize\(\) string](<#FetchStats.HumanSize>)
- [type ID](<#ID>)
  - [func IDs\(\) \[\]ID](<#IDs>)
  - [func \(id ID\) IsValid\(\) bool](<#ID.IsValid>)
  - [func \(id ID\) String\(\) string](<#ID.String>)
- [type Option](<#Option>)
  - [func WithCleanupRepo\(cleanup bool\) Option](<#WithCleanupRepo>)
  - [func WithFresh\(fresh bool\) Option](<#WithFresh>)
  - [func WithProviderFilter\(providerID catalogs.ProviderID\) Option](<#WithProviderFilter>)
  - [func WithReformat\(reformat bool\) Option](<#WithReformat>)
  - [func WithSafeMode\(safeMode bool\) Option](<#WithSafeMode>)
- [type Options](<#Options>)
  - [func Defaults\(\) \*Options](<#Defaults>)
  - [func \(o \*Options\) Apply\(opts ...Option\) \*Options](<#Options.Apply>)
- [type ProviderFetcher](<#ProviderFetcher>)
  - [func NewProviderFetcher\(providers \*catalogs.Providers, opts ...ProviderOption\) \*ProviderFetcher](<#NewProviderFetcher>)
  - [func \(pf \*ProviderFetcher\) FetchModels\(ctx context.Context, provider \*catalogs.Provider, opts ...ProviderOption\) \(\[\]catalogs.Model, error\)](<#ProviderFetcher.FetchModels>)
  - [func \(pf \*ProviderFetcher\) FetchRawResponse\(ctx context.Context, provider \*catalogs.Provider, endpoint string, opts ...ProviderOption\) \(\[\]byte, \*FetchStats, error\)](<#ProviderFetcher.FetchRawResponse>)
  - [func \(pf \*ProviderFetcher\) HasClient\(id catalogs.ProviderID\) bool](<#ProviderFetcher.HasClient>)
  - [func \(pf \*ProviderFetcher\) List\(\) \[\]catalogs.ProviderID](<#ProviderFetcher.List>)
  - [func \(pf \*ProviderFetcher\) Providers\(\) \*catalogs.Providers](<#ProviderFetcher.Providers>)
- [type ProviderOption](<#ProviderOption>)
  - [func WithAllowMissingAPIKey\(\) ProviderOption](<#WithAllowMissingAPIKey>)
  - [func WithTimeout\(d time.Duration\) ProviderOption](<#WithTimeout>)
  - [func WithoutCredentialLoading\(\) ProviderOption](<#WithoutCredentialLoading>)
- [type ResourceType](<#ResourceType>)
- [type Source](<#Source>)
- [type Sources](<#Sources>)
  - [func NewSources\(\) \*Sources](<#NewSources>)
  - [func \(s \*Sources\) Delete\(id ID\)](<#Sources.Delete>)
  - [func \(s \*Sources\) Get\(id ID\) \(Source, bool\)](<#Sources.Get>)
  - [func \(s \*Sources\) IDs\(\) \[\]ID](<#Sources.IDs>)
  - [func \(s \*Sources\) Len\(\) int](<#Sources.Len>)
  - [func \(s \*Sources\) List\(\) \[\]Source](<#Sources.List>)
  - [func \(s \*Sources\) Set\(id ID, src Source\)](<#Sources.Set>)


<a name="Dependency"></a>
## type [Dependency](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L157-L175>)

Dependency represents an external tool or runtime required by a source.

```go
type Dependency struct {
    // Core identification
    Name        string // Machine name: "bun", "git", "docker"
    DisplayName string // Human-readable: "Bun JavaScript runtime"
    Required    bool   // false = source is optional or has fallback

    // Checking availability
    CheckCommands []string // Try in order: ["bun", "bunx"]
    MinVersion    string   // Optional: "1.0.0"

    // Installation
    InstallURL         string // https://bun.sh/docs/installation
    AutoInstallCommand string // Optional: "curl -fsSL https://bun.sh/install | bash"

    // User messaging
    Description       string // "Builds models.dev data locally (same as HTTP source)"
    WhyNeeded         string // "Required to build api.json from TypeScript source"
    AlternativeSource string // "models_dev_http provides same data without dependencies"
}
```

<a name="DependencyStatus"></a>
## type [DependencyStatus](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L178-L183>)

DependencyStatus represents the availability status of a dependency.

```go
type DependencyStatus struct {
    Available  bool   // Whether the dependency is available
    Version    string // Version string if available and detectable
    Path       string // Full path to executable if found
    CheckError error  // Error from check command if not available
}
```

<a name="FetchStats"></a>
## type [FetchStats](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L49-L58>)

FetchStats contains metadata about a fetch operation. This provides transparency into API requests for debugging and monitoring.

```go
type FetchStats struct {
    URL          string        // Endpoint that was called
    StatusCode   int           // HTTP response status code
    Latency      time.Duration // Request duration
    PayloadSize  int64         // Response body size in bytes
    ContentType  string        // Content-Type from response header
    AuthMethod   string        // How authentication was applied (Header, Query, None)
    AuthLocation string        // Where auth was placed (header name or query param name)
    AuthScheme   string        // Authentication scheme for header auth (Bearer, Basic, Direct)
}
```

<a name="FetchStats.HumanSize"></a>
### func \(\*FetchStats\) [HumanSize](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L61>)

```go
func (s *FetchStats) HumanSize() string
```

HumanSize returns the payload size in human\-readable format.

<a name="ID"></a>
## type [ID](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L99>)

ID represents the identifier of a data source.

```go
type ID string
```

<a name="ProvidersID"></a>Common source names.

```go
const (
    ProvidersID     ID  = "providers"
    ModelsDevGitID  ID  = "models_dev_git"
    ModelsDevHTTPID ID  = "models_dev_http"
    LocalCatalogID  ID  = "local_catalog"
)
```

<a name="IDs"></a>
### func [IDs](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L116>)

```go
func IDs() []ID
```

IDs returns all available source types. This provides a convenient way to iterate over all Type values.

<a name="ID.IsValid"></a>
### func \(ID\) [IsValid](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L127>)

```go
func (id ID) IsValid() bool
```

IsValid returns true if the ID is one of the defined constants. Uses IDs\(\) to ensure consistency with the authoritative id list.

<a name="ID.String"></a>
### func \(ID\) [String](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L102>)

```go
func (id ID) String() string
```

String returns the string representation of a source name.

<a name="Option"></a>
## type [Option](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L34>)

Option is a function that configures options.

```go
type Option func(*Options)
```

<a name="WithCleanupRepo"></a>
### func [WithCleanupRepo](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L67>)

```go
func WithCleanupRepo(cleanup bool) Option
```

WithCleanupRepo configures whether to clean up temporary repositories after fetch.

<a name="WithFresh"></a>
### func [WithFresh](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L53>)

```go
func WithFresh(fresh bool) Option
```

WithFresh configures fresh sync mode for sources.

<a name="WithProviderFilter"></a>
### func [WithProviderFilter](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L46>)

```go
func WithProviderFilter(providerID catalogs.ProviderID) Option
```

WithProviderFilter configures filtering for a specific provider.

<a name="WithReformat"></a>
### func [WithReformat](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L74>)

```go
func WithReformat(reformat bool) Option
```

WithReformat configures whether to reformat output files.

<a name="WithSafeMode"></a>
### func [WithSafeMode](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L60>)

```go
func WithSafeMode(safeMode bool) Option
```

WithSafeMode configures safe mode for sources.

<a name="Options"></a>
## type [Options](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L9-L20>)

Options is the configuration for sources.

```go
type Options struct {
    // Provider filtering (needed by provider source)
    ProviderID *catalogs.ProviderID

    // Behavior flags (needed by various sources)
    Fresh    bool // Fresh sync (delete existing before adding)
    SafeMode bool // Don't delete models, only add/update

    // Typed source-specific options
    CleanupRepo bool // For models.dev git source - remove repo after fetch
    Reformat    bool // For file-based sources - reformat output files
}
```

<a name="Defaults"></a>
### func [Defaults](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L23>)

```go
func Defaults() *Options
```

Defaults returns source options with default values.

<a name="Options.Apply"></a>
### func \(\*Options\) [Apply](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L38>)

```go
func (o *Options) Apply(opts ...Option) *Options
```

Apply applies a set of options to create configured sourceOptions This is a helper for sources to use internally.

<a name="ProviderFetcher"></a>
## type [ProviderFetcher](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L16-L19>)

ProviderFetcher provides operations for fetching models from provider APIs. This is the public API for external packages to interact with provider data.

```go
type ProviderFetcher struct {
    // contains filtered or unexported fields
}
```

<a name="NewProviderFetcher"></a>
### func [NewProviderFetcher](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L118>)

```go
func NewProviderFetcher(providers *catalogs.Providers, opts ...ProviderOption) *ProviderFetcher
```

NewProviderFetcher creates a new provider fetcher for interacting with provider APIs. It provides a clean public interface for external packages. The providers parameter should contain the catalog providers to create clients for.

<a name="ProviderFetcher.FetchModels"></a>
### func \(\*ProviderFetcher\) [FetchModels](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L202>)

```go
func (pf *ProviderFetcher) FetchModels(ctx context.Context, provider *catalogs.Provider, opts ...ProviderOption) ([]catalogs.Model, error)
```

FetchModels fetches available models from a single provider's API. It handles credential loading, client creation, and API communication.

Example:

```
fetcher := NewProviderFetcher()
models, err := fetcher.FetchModels(ctx, provider)
```

With options:

```
fetcher := NewProviderFetcher(WithTimeout(30 * time.Second))
models, err := fetcher.FetchModels(ctx, provider, WithAllowMissingAPIKey())
```

<a name="ProviderFetcher.FetchRawResponse"></a>
### func \(\*ProviderFetcher\) [FetchRawResponse](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L271>)

```go
func (pf *ProviderFetcher) FetchRawResponse(ctx context.Context, provider *catalogs.Provider, endpoint string, opts ...ProviderOption) ([]byte, *FetchStats, error)
```

FetchRawResponse fetches the raw API response from a provider's endpoint. This is useful for testing, debugging, or saving raw responses as testdata.

The endpoint parameter should be the full URL to the API endpoint. The response is returned as raw bytes \(JSON\) without any parsing, along with fetch statistics.

<a name="ProviderFetcher.HasClient"></a>
### func \(\*ProviderFetcher\) [HasClient](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L154>)

```go
func (pf *ProviderFetcher) HasClient(id catalogs.ProviderID) bool
```

HasClient checks if a provider ID has a client implementation.

<a name="ProviderFetcher.List"></a>
### func \(\*ProviderFetcher\) [List](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L143>)

```go
func (pf *ProviderFetcher) List() []catalogs.ProviderID
```

List returns all provider IDs that have client implementations.

<a name="ProviderFetcher.Providers"></a>
### func \(\*ProviderFetcher\) [Providers](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L128>)

```go
func (pf *ProviderFetcher) Providers() *catalogs.Providers
```

Providers returns the providers that can be used by the provider fetcher.

<a name="ProviderOption"></a>
## type [ProviderOption](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L36>)

ProviderOption configures ProviderFetcher behavior.

```go
type ProviderOption func(*providerOptions)
```

<a name="WithAllowMissingAPIKey"></a>
### func [WithAllowMissingAPIKey](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L176>)

```go
func WithAllowMissingAPIKey() ProviderOption
```

WithAllowMissingAPIKey allows operations even when API key is not configured. Useful for checking provider support without credentials.

<a name="WithTimeout"></a>
### func [WithTimeout](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L184>)

```go
func WithTimeout(d time.Duration) ProviderOption
```

WithTimeout sets a timeout for provider operations. The timeout applies to the context passed to FetchModels.

<a name="WithoutCredentialLoading"></a>
### func [WithoutCredentialLoading](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L168>)

```go
func WithoutCredentialLoading() ProviderOption
```

WithoutCredentialLoading disables automatic credential loading from environment. Use this when credentials are already loaded or when testing.

<a name="ResourceType"></a>
## type [ResourceType](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L186>)

ResourceType identifies the type of resource being merged.

```go
type ResourceType string
```

<a name="ResourceTypeModel"></a>

```go
const (
    // ResourceTypeModel represents a model resource.
    ResourceTypeModel ResourceType = "model"
    // ResourceTypeProvider represents a provider resource.
    ResourceTypeProvider ResourceType = "provider"
    // ResourceTypeAuthor represents an author resource.
    ResourceTypeAuthor ResourceType = "author"
)
```

<a name="Source"></a>
## type [Source](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L132-L154>)

Source represents a data source for catalog information.

```go
type Source interface {
    // Type returns the type of this source
    ID() ID

    // Name returns a human-friendly name for this source
    Name() string

    // Fetch retrieves data from this source
    // Sources handle their own concurrency internally
    Fetch(ctx context.Context, opts ...Option) error

    // Catalog returns the catalog of this source
    Catalog() catalogs.Catalog

    // Cleanup releases any resources (called after all Fetch operations)
    Cleanup() error

    // Dependencies returns the list of external dependencies this source requires
    Dependencies() []Dependency

    // IsOptional returns true if the sync can succeed without this source
    IsOptional() bool
}
```

<a name="Sources"></a>
## type [Sources](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L35-L38>)

Sources is a thread\-safe container for managing multiple data sources.

```go
type Sources struct {
    // contains filtered or unexported fields
}
```

<a name="NewSources"></a>
### func [NewSources](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L41>)

```go
func NewSources() *Sources
```

NewSources creates a new Sources instance.

<a name="Sources.Delete"></a>
### func \(\*Sources\) [Delete](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L63>)

```go
func (s *Sources) Delete(id ID)
```

Delete deletes a source by ID.

<a name="Sources.Get"></a>
### func \(\*Sources\) [Get](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L48>)

```go
func (s *Sources) Get(id ID) (Source, bool)
```

Get returns a source by ID.

<a name="Sources.IDs"></a>
### func \(\*Sources\) [IDs](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L88>)

```go
func (s *Sources) IDs() []ID
```

IDs returns a slice of all source IDs.

<a name="Sources.Len"></a>
### func \(\*Sources\) [Len](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L70>)

```go
func (s *Sources) Len() int
```

Len returns the number of sources.

<a name="Sources.List"></a>
### func \(\*Sources\) [List](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L77>)

```go
func (s *Sources) List() []Source
```

List returns a slice of all sources.

<a name="Sources.Set"></a>
### func \(\*Sources\) [Set](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L56>)

```go
func (s *Sources) Set(id ID, src Source)
```

Set sets a source by ID.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->