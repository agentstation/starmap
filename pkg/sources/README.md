# sources

Package sources provides abstractions for fetching AI model catalog data from various external sources including provider APIs and community repositories.

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# sources

```go
import "github.com/agentstation/starmap/pkg/sources"
```

Package sources provides public APIs for working with AI model data sources.

Package sources defines interfaces and types for catalog data sources. Sources are responsible for fetching and synchronizing model data from various providers including local files, provider APIs, and external repositories.

The package provides a unified interface for different data sources while supporting merge strategies, authorities for data precedence, and flexible configuration options.

Example usage:

```
// Create a provider fetcher
fetcher := NewProviderFetcher()

// Fetch models from a provider
models, err := fetcher.FetchModels(ctx, provider)
if err != nil {
    log.Fatal(err)
}

// Check if a provider is supported
if fetcher.HasClient(providerID) {
    // Provider has a client implementation
}
```

## Index

- [type Option](<#Option>)
  - [func WithCleanupRepo\(cleanup bool\) Option](<#WithCleanupRepo>)
  - [func WithFresh\(fresh bool\) Option](<#WithFresh>)
  - [func WithProviderFilter\(providerID catalogs.ProviderID\) Option](<#WithProviderFilter>)
  - [func WithReformat\(reformat bool\) Option](<#WithReformat>)
  - [func WithSafeMode\(safeMode bool\) Option](<#WithSafeMode>)
- [type Options](<#Options>)
  - [func ApplyOptions\(opts ...Option\) \*Options](<#ApplyOptions>)
- [type ProviderFetcher](<#ProviderFetcher>)
  - [func NewProviderFetcher\(opts ...ProviderOption\) \*ProviderFetcher](<#NewProviderFetcher>)
  - [func \(pf \*ProviderFetcher\) FetchModels\(ctx context.Context, provider \*catalogs.Provider, opts ...ProviderOption\) \(\[\]catalogs.Model, error\)](<#ProviderFetcher.FetchModels>)
  - [func \(pf \*ProviderFetcher\) FetchRawResponse\(ctx context.Context, provider \*catalogs.Provider, endpoint string, opts ...ProviderOption\) \(\[\]byte, error\)](<#ProviderFetcher.FetchRawResponse>)
  - [func \(pf \*ProviderFetcher\) HasClient\(id catalogs.ProviderID\) bool](<#ProviderFetcher.HasClient>)
  - [func \(pf \*ProviderFetcher\) List\(\) \[\]catalogs.ProviderID](<#ProviderFetcher.List>)
- [type ProviderOption](<#ProviderOption>)
  - [func WithAllowMissingAPIKey\(\) ProviderOption](<#WithAllowMissingAPIKey>)
  - [func WithTimeout\(d time.Duration\) ProviderOption](<#WithTimeout>)
  - [func WithoutCredentialLoading\(\) ProviderOption](<#WithoutCredentialLoading>)
- [type ResourceType](<#ResourceType>)
- [type Source](<#Source>)
- [type Type](<#Type>)
  - [func \(sn Type\) String\(\) string](<#Type.String>)


<a name="Option"></a>
## type [Option](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L31>)

Option is a function that configures options.

```go
type Option func(*Options)
```

<a name="WithCleanupRepo"></a>
### func [WithCleanupRepo](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L55>)

```go
func WithCleanupRepo(cleanup bool) Option
```

WithCleanupRepo configures whether to clean up temporary repositories after fetch.

<a name="WithFresh"></a>
### func [WithFresh](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L41>)

```go
func WithFresh(fresh bool) Option
```

WithFresh configures fresh sync mode for sources.

<a name="WithProviderFilter"></a>
### func [WithProviderFilter](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L34>)

```go
func WithProviderFilter(providerID catalogs.ProviderID) Option
```

WithProviderFilter configures filtering for a specific provider.

<a name="WithReformat"></a>
### func [WithReformat](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L62>)

```go
func WithReformat(reformat bool) Option
```

WithReformat configures whether to reformat output files.

<a name="WithSafeMode"></a>
### func [WithSafeMode](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L48>)

```go
func WithSafeMode(safeMode bool) Option
```

WithSafeMode configures safe mode for sources.

<a name="Options"></a>
## type [Options](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L6-L17>)

Options is the configuration for sources.

```go
type Options struct {
    // Provider filtering (needed by provider source)
    ProviderID *catalogs.ProviderID

    // Behavior flags (needed by various sources)
    Fresh    bool // Fresh sync (delete existing before adding)
    SafeMode bool // Don't delete models, only add/update

    // Typed source-specific options
    CleanupRepo bool // For models.dev git source - remove repo after fetch
    Reformat    bool // For file-based sources - reformat output files
}
```

<a name="ApplyOptions"></a>
### func [ApplyOptions](<https://github.com/agentstation/starmap/blob/master/pkg/sources/options.go#L70>)

```go
func ApplyOptions(opts ...Option) *Options
```

ApplyOptions applies a set of options to create configured sourceOptions This is a helper for sources to use internally.

<a name="ProviderFetcher"></a>
## type [ProviderFetcher](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L33-L39>)

ProviderFetcher provides operations for fetching models from provider APIs. This is the public API for external packages to interact with provider data.

```go
type ProviderFetcher struct {
    // contains filtered or unexported fields
}
```

<a name="NewProviderFetcher"></a>
### func [NewProviderFetcher](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L62>)

```go
func NewProviderFetcher(opts ...ProviderOption) *ProviderFetcher
```

NewProviderFetcher creates a new provider fetcher for interacting with provider APIs. It provides a clean public interface for external packages.

<a name="ProviderFetcher.FetchModels"></a>
### func \(\*ProviderFetcher\) [FetchModels](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L113>)

```go
func (pf *ProviderFetcher) FetchModels(ctx context.Context, provider *catalogs.Provider, opts ...ProviderOption) ([]catalogs.Model, error)
```

FetchModels fetches available models from a single provider's API. It handles credential loading, client creation, and API communication.

Example:

```
fetcher := NewProviderFetcher()
models, err := fetcher.FetchModels(ctx, provider)
```

With options:

```
fetcher := NewProviderFetcher(WithTimeout(30 * time.Second))
models, err := fetcher.FetchModels(ctx, provider, WithAllowMissingAPIKey())
```

<a name="ProviderFetcher.FetchRawResponse"></a>
### func \(\*ProviderFetcher\) [FetchRawResponse](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L207>)

```go
func (pf *ProviderFetcher) FetchRawResponse(ctx context.Context, provider *catalogs.Provider, endpoint string, opts ...ProviderOption) ([]byte, error)
```

FetchRawResponse fetches the raw API response from a provider's endpoint. This is useful for testing, debugging, or saving raw responses as testdata.

The endpoint parameter should be the full URL to the API endpoint. The response is returned as raw bytes \(JSON\) without any parsing.

<a name="ProviderFetcher.HasClient"></a>
### func \(\*ProviderFetcher\) [HasClient](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L186>)

```go
func (pf *ProviderFetcher) HasClient(id catalogs.ProviderID) bool
```

HasClient checks if a provider has a client implementation available. This can be used to determine which providers are supported.

<a name="ProviderFetcher.List"></a>
### func \(\*ProviderFetcher\) [List](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L195>)

```go
func (pf *ProviderFetcher) List() []catalogs.ProviderID
```

List returns all provider IDs that have client implementations. This is useful for discovering which providers can be used with FetchModels.

<a name="ProviderOption"></a>
## type [ProviderOption](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L49>)

ProviderOption configures ProviderFetcher behavior.

```go
type ProviderOption func(*providerOptions)
```

<a name="WithAllowMissingAPIKey"></a>
### func [WithAllowMissingAPIKey](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L87>)

```go
func WithAllowMissingAPIKey() ProviderOption
```

WithAllowMissingAPIKey allows operations even when API key is not configured. Useful for checking provider support without credentials.

<a name="WithTimeout"></a>
### func [WithTimeout](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L95>)

```go
func WithTimeout(d time.Duration) ProviderOption
```

WithTimeout sets a timeout for provider operations. The timeout applies to the context passed to FetchModels.

<a name="WithoutCredentialLoading"></a>
### func [WithoutCredentialLoading](<https://github.com/agentstation/starmap/blob/master/pkg/sources/providers.go#L79>)

```go
func WithoutCredentialLoading() ProviderOption
```

WithoutCredentialLoading disables automatic credential loading from environment. Use this when credentials are already loaded or when testing.

<a name="ResourceType"></a>
## type [ResourceType](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L68>)

ResourceType identifies the type of resource being merged.

```go
type ResourceType string
```

<a name="ResourceTypeModel"></a>

```go
const (
    // ResourceTypeModel represents a model resource.
    ResourceTypeModel ResourceType = "model"
    // ResourceTypeProvider represents a provider resource.
    ResourceTypeProvider ResourceType = "provider"
    // ResourceTypeAuthor represents an author resource.
    ResourceTypeAuthor ResourceType = "author"
)
```

<a name="Source"></a>
## type [Source](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L49-L65>)

Source represents a data source for catalog information.

```go
type Source interface {
    // Type returns the type of this source
    Type() Type

    // Setup initializes the source with dependencies (called once before Fetch)
    Setup(providers *catalogs.Providers) error

    // Fetch retrieves data from this source
    // Sources handle their own concurrency internally
    Fetch(ctx context.Context, opts ...Option) error

    // Catalog returns the catalog of this source
    Catalog() catalogs.Catalog

    // Cleanup releases any resources (called after all Fetch operations)
    Cleanup() error
}
```

<a name="Type"></a>
## type [Type](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L33>)

Type represents the type/name of a data source.

```go
type Type string
```

<a name="ProviderAPI"></a>Common source names.

```go
const (
    ProviderAPI   Type = "Provider APIs"
    ModelsDevGit  Type = "models.dev (git)"
    ModelsDevHTTP Type = "models.dev (http)"
    LocalCatalog  Type = "Local Catalog"
)
```

<a name="Type.String"></a>
### func \(Type\) [String](<https://github.com/agentstation/starmap/blob/master/pkg/sources/source.go#L36>)

```go
func (sn Type) String() string
```

String returns the string representation of a source name.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->